name: commit-tests
on: [push]
jobs:
  # MiaB-LDAP connected to a remote Nextcloud
  remote-nextcloud-docker:
    runs-on: ubuntu-18.04
    env:
      PRIMARY_HOSTNAME: box1.abc.com
      FEATURE_MUNIN: false
    steps:
      - uses: actions/checkout@v2
      # without nanasess/setup-pup setup/webmail.sh returns "Unsupported PHP version. Required PHP >= 5.4 and < 8.0", which is generated by roundcubemail/program/include/iniset.php indicating that PHP >= 8.0
      # However, setup/zpush.sh then fails to install package "php-xsl" with "E: Package 'php-xsl' has no installation candidate"
      # - uses: nanasess/setup-php@master
      #   with:
      #     php-version: '7.2'
      - name: update-system-php
        run: sudo update-alternatives --set php /usr/bin/php7.2
      - name: setup
        run: sudo -E tests/system-setup/remote-nextcloud-docker.sh upgrade basic
      - name: test-runner
        run: sudo -E tests/runner.sh -dumpoutput -no-smtp-remote default remote-nextcloud upgrade-basic

