load '../funcs.rb'

Vagrant.configure("2") do |config|

  config.vm.synced_folder "../../..", "/mailinabox", id: "mailinabox", automount: false
  config.vm.network "public_network", bridge: "#$default_network_interface"
  use_preloaded_box config, "ubuntu/jammy64", ".."

  # vanilla install

  config.vm.define "vanilla" do |m1|
    m1.vm.provision :shell, :inline => <<-SH
cat >/tmp/provision.sh <<EOF
#!/bin/bash
if [ \$EUID -ne 0 ]; then
   echo "Must be root"
   exit 1
fi
cd /mailinabox
export PRIMARY_HOSTNAME=vanilla.local
export FEATURE_MUNIN=false
export FEATURE_NEXTCLOUD=false
export SKIP_SYSTEM_UPDATE=0
tests/system-setup/vanilla.sh \
   --enable-mod=roundcube-master \
   --enable-mod=roundcube-debug \
   --enable-mod=rcmcarddav-composer
EOF
chmod +x /tmp/provision.sh
/tmp/provision.sh
SH
  end


end
